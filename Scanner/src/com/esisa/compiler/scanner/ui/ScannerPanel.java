package com.esisa.compiler.scanner.ui;

import java.awt.BorderLayout;
import java.awt.Color;
import java.awt.Dimension;
import java.awt.event.ActionEvent;
import java.awt.event.ActionListener;
import java.io.File;
import java.util.Vector;

import javax.swing.JButton;
import javax.swing.JFileChooser;
import javax.swing.JPanel;
import javax.swing.JScrollBar;
import javax.swing.JScrollPane;
import javax.swing.JTextArea;

import com.esisa.compiler.scanner.Error;
import com.esisa.compiler.scanner.Scanner;
import com.esisa.compiler.scanner.Token;

public class ScannerPanel extends JPanel implements ActionListener{
	private static final long serialVersionUID = 1L;
	
	private Toolbar toolbar;
	private TextArea source;
	private DataTable table;//Table symboles
	private DataList errors;//Liste erreurs 
	private JFileChooser explorer;
	
	private Vector<Token> tokens;
	private Vector<Error> error;
	
	private Scanner scanner;
	private ScannerAction action;

	public ScannerPanel(Scanner scanner) {
		this.scanner = scanner;
		action = new ScannerAction();
		
		setLayout(new BorderLayout());
		toolbar = new Toolbar("resources/icons", ".png", "new_icon", "open_icon", "save_icon", "scan_icon","exit_icon");
		add("North",toolbar);
		
		//toolbar.get(3).addActionListener(this);
		
		//toolbar.addActionListener(3, this);
		
		toolbar.addActionListener(this);
		
		source = new TextArea("Example.cpp");
		add("Center", source);
		
		table = new DataTable("Table Des Symboles", "Lexème", "Unité Lexical");
		add("East",table);
		table.setPreferredSize(new Dimension(450, 0));
		//table.addRow("alpha","id");
		//table.addRow("20.5", "nb");
		
		errors = new DataList("Erreurs Lexicales", Color.blue, Color.red);
		add("South",errors);
		errors.setPreferredSize(new Dimension(0, 100));
		//errors.add("Une erreur lexicale");
		//errors.add("Une autre erreur lexicale");
		
		explorer = new JFileChooser(".");
		
	}
	
	public static void main(String[] args) {
		
	}

	
	public void actionPerformed(ActionEvent e) {
		JButton src = (JButton) e.getSource();
		
		//if(src == toolbar.get(3)){
		if(src.getName().equals("scan_icon")){
			action.scan();
		}
		else if(src.getName().equals("exit_icon")){
			action.exit();
		}
		else if(src.getName().equals("new_icon")){
			action.newFile();
		}
		else if(src.getName().equals("save_icon")){
			action.save();
		}
		else if(src.getName().equals("open_icon")){
			action.open();
		}
		
	}
	
	private class ScannerAction {
		public ScannerAction() {
			
		}
		
		public void newFile() {
			source.setText("");
		}
		
		public void open() {
			explorer.showOpenDialog(null);
			
			File file = explorer.getSelectedFile();
			System.out.println(file.getName());
			System.out.println(file.getPath());
		}
		
		public void save() {
			//File
		}
		
		public void scan() {
			table.clear();
			errors.clear();
			
			
			tokens = scanner.scan(source.getText());
		
			for (Token token : tokens) {
				table.addRow(token.getValue(),token.getType());
			}
			
			error = scanner.getErrors();
			
			for (Error errorOutput : error) {
				errors.add(errorOutput.toString());
			}
		}
		
		public void exit() {
			System.exit(0);
		}
	}
	
}


	
